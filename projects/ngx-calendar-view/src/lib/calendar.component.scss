@use 'tailwind';

// Dark mode color overrides
:host-context(.dark) .ncv-calendar-container {
  // Base Colors
  --calendar-primary: #3b82f6;
  --calendar-secondary: #94a3b8;
  --calendar-background: #1e293b;
  --calendar-surface: #0f172a;
  --calendar-border: #334155;
  --calendar-text: #f1f5f9;
  --calendar-text-secondary: #94a3b8;

  // Additional Colors (slightly adjusted for dark mode)
  --calendar-success: #22c55e;
  --calendar-warning: #fbbf24;
  --calendar-error: #f87171;
  --calendar-info: #60a5fa;

  // Neutral Colors (dark mode grays)
  --calendar-gray-50: #0f172a;
  --calendar-gray-100: #1e293b;
  --calendar-gray-200: #334155;
  --calendar-gray-300: #475569;
  --calendar-gray-400: #64748b;
  --calendar-gray-500: #94a3b8;
  --calendar-gray-600: #cbd5e1;
  --calendar-gray-700: #e2e8f0;
  --calendar-gray-800: #f1f5f9;
  --calendar-gray-900: #f8fafc;

  // Shadows (adjusted for dark mode)
  --calendar-shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
  --calendar-shadow-md: 0 2px 4px rgba(0, 0, 0, 0.4);
  --calendar-shadow-lg: 0 2px 8px rgba(0, 0, 0, 0.5);
  --calendar-shadow-xl: 0 4px 12px rgba(0, 0, 0, 0.5);
  --calendar-shadow-2xl: 0 8px 25px rgba(0, 0, 0, 0.6);
  --calendar-shadow-primary: 0 2px 4px rgba(59, 130, 246, 0.5);
  --calendar-shadow-primary-lg: 0 4px 12px rgba(59, 130, 246, 0.5);
  --calendar-shadow-inset: inset 0 0 0 2px rgba(96, 165, 250, 0.4);
  --calendar-shadow-inset-hover: inset 0 0 0 2px rgba(96, 165, 250, 0.6);
}

.ncv-calendar-container {
  // Base Colors
  --calendar-primary: #2563eb;
  --calendar-secondary: #64748b;
  --calendar-background: #ffffff;
  --calendar-surface: #f8fafc;
  --calendar-border: #e2e8f0;
  --calendar-text: #1e293b;
  --calendar-text-secondary: #64748b;

  // Additional Colors
  --calendar-success: #10b981;
  --calendar-warning: #f59e0b;
  --calendar-error: #ef4444;
  --calendar-info: #3b82f6;

  // Neutral Colors
  --calendar-gray-50: #f9fafb;
  --calendar-gray-100: #f3f4f6;
  --calendar-gray-200: #e5e7eb;
  --calendar-gray-300: #d1d5db;
  --calendar-gray-400: #9ca3af;
  --calendar-gray-500: #6b7280;
  --calendar-gray-600: #4b5563;
  --calendar-gray-700: #374151;
  --calendar-gray-800: #1f2937;
  --calendar-gray-900: #111827;

  // Shadows
  --calendar-shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
  --calendar-shadow-md: 0 2px 4px rgba(0, 0, 0, 0.1);
  --calendar-shadow-lg: 0 2px 8px rgba(0, 0, 0, 0.15);
  --calendar-shadow-xl: 0 4px 12px rgba(0, 0, 0, 0.15);
  --calendar-shadow-2xl: 0 8px 25px rgba(0, 0, 0, 0.25);
  --calendar-shadow-primary: 0 2px 4px rgba(37, 99, 235, 0.3);
  --calendar-shadow-primary-lg: 0 4px 12px rgba(37, 99, 235, 0.3);
  --calendar-shadow-inset: inset 0 0 0 2px rgba(59, 130, 246, 0.3);
  --calendar-shadow-inset-hover: inset 0 0 0 2px rgba(59, 130, 246, 0.5);

  // Border Radius
  --calendar-radius-sm: 0.25rem;
  --calendar-radius-md: 0.375rem;
  --calendar-radius-lg: 0.5rem;
  --calendar-radius-xl: 0.75rem;

  // Border Widths
  --calendar-border-width: 1px;
  --calendar-border-width-thick: 2px;

  // Spacing
  --calendar-spacing-xs: 0.125rem;
  --calendar-spacing-sm: 0.25rem;
  --calendar-spacing-md: 0.5rem;
  --calendar-spacing-lg: 0.75rem;
  --calendar-spacing-xl: 1rem;
  --calendar-spacing-2xl: 1.5rem;
  --calendar-spacing-3xl: 2rem;

  // Typography
  --calendar-font-size-xs: 0.6875rem;
  --calendar-font-size-sm: 0.75rem;
  --calendar-font-size-base: 0.875rem;
  --calendar-font-size-lg: 1rem;
  --calendar-font-size-xl: 1.125rem;
  --calendar-font-size-2xl: 1.25rem;

  --calendar-font-weight-normal: 400;
  --calendar-font-weight-medium: 500;
  --calendar-font-weight-semibold: 600;
  --calendar-font-weight-bold: 700;

  --calendar-line-height-tight: 1.2;
  --calendar-line-height-normal: 1.3;
  --calendar-line-height-relaxed: 1.5;

  // Transitions
  --calendar-transition-fast: 0.15s ease;
  --calendar-transition-normal: 0.2s ease;
  --calendar-transition-slow: 0.3s ease;

  // Z-Index
  --calendar-z-dropdown: 10;
  --calendar-z-sticky: 20;
  --calendar-z-modal: 1000;
  --calendar-z-popover: 9999;

  // Opacity
  --calendar-opacity-disabled: 0.5;
  --calendar-opacity-hover: 0.9;
  --calendar-opacity-drag: 0.7;
}


.ncv-view-type-button {
  padding: var(--calendar-spacing-md) var(--calendar-spacing-xl);
  font-size: var(--calendar-font-size-base);
  font-weight: var(--calendar-font-weight-medium);
  border-radius: var(--calendar-radius-lg);
  transition: all var(--calendar-transition-normal);
  border: var(--calendar-border-width) solid;
}

.ncv-view-type-button.ncv-active {
  background-color: var(--calendar-primary);
  color: var(--calendar-background);
  border-color: var(--calendar-primary);
  box-shadow: var(--calendar-shadow-sm);
  transform: translateY(-1px);
  box-shadow: var(--calendar-shadow-primary);
}

.ncv-view-type-button.ncv-inactive {
  background-color: var(--calendar-background);
  color: var(--calendar-text);
  border-color: var(--calendar-border);
}

.ncv-view-type-button.ncv-inactive:hover {
  background-color: var(--calendar-surface);
  border-color: var(--calendar-primary);
  color: var(--calendar-primary);
  transform: translateY(-1px);
  box-shadow: var(--calendar-shadow-md);
}

// View type selector container
.ncv-view-type-selector {
  display: flex;
  align-items: center;
  gap: var(--calendar-spacing-sm);
  background-color: var(--calendar-surface);
  padding: var(--calendar-spacing-sm);
  border-radius: var(--calendar-radius-lg);
  border: var(--calendar-border-width) solid var(--calendar-border);
}

// Today button styles
.ncv-today-button {
  padding: var(--calendar-spacing-md) var(--calendar-spacing-xl);
  font-size: var(--calendar-font-size-base);
  font-weight: var(--calendar-font-weight-medium);
  border-radius: var(--calendar-radius-md);
  transition: all var(--calendar-transition-normal);
  border: var(--calendar-border-width) solid;
}

.ncv-today-button.ncv-viewing-today {
  background-color: var(--calendar-primary);
  color: var(--calendar-background);
  border-color: var(--calendar-primary);
  box-shadow: var(--calendar-shadow-sm);
  transform: translateY(-1px);
  box-shadow: var(--calendar-shadow-primary);
}

.ncv-today-button.ncv-viewing-today:hover {
  opacity: var(--calendar-opacity-hover);
}

.ncv-today-button.ncv-not-viewing-today {
  background-color: var(--calendar-gray-100);
  color: var(--calendar-gray-500);
  border-color: var(--calendar-gray-300);
}

.ncv-today-button.ncv-not-viewing-today:hover {
  background-color: var(--calendar-gray-200);
  color: var(--calendar-gray-700);
  border-color: var(--calendar-gray-400);
  transform: translateY(-1px);
  box-shadow: var(--calendar-shadow-md);
}

// Event card styles with proper positioning
.ncv-event-card {
  transition: all var(--calendar-transition-normal) ease-in-out;
  position: absolute;
  z-index: var(--calendar-z-dropdown);

  &:hover {
    transform: translateY(-1px);
    box-shadow: var(--calendar-shadow-lg);
    z-index: var(--calendar-z-sticky); // Bring to front on hover
  }

  // Drag states
  &.ncv-dragging {
    opacity: var(--calendar-opacity-drag);
    transform: scale(1.05);
    z-index: var(--calendar-z-modal);
    box-shadow: var(--calendar-shadow-xl);
    cursor: grabbing;
  }

  &.ncv-drag-over {
    background-color: rgba(59, 130, 246, 0.1) !important;
    border-color: var(--calendar-info) !important;
  }
}

// Time slot styles for better event positioning
.ncv-time-slot {
  min-height: 2rem;
  position: relative;
  overflow: visible; // Allow events to extend beyond slot boundaries
  transition: all var(--calendar-transition-normal);

  &.ncv-drop-zone-active {
    background-color: rgba(59, 130, 246, 0.1);
    border-color: var(--calendar-info);
    box-shadow: var(--calendar-shadow-inset);
    &:hover {
      background-color: rgba(59, 130, 246, 0.3);
      border-color: var(--calendar-info);
      box-shadow: var(--calendar-shadow-inset-hover);
    }
  }


  &.ncv-drag-hover-active {
    background-color: rgba(59, 130, 246, 0.1);
    border-color: var(--calendar-info);
    box-shadow: var(--calendar-shadow-inset);
  }
}

// Ensure time slots container allows overflow
.ncv-time-slots {
  position: relative;
  overflow: visible;
}

// Calendar views container
.ncv-calendar-day-view,
.ncv-calendar-week-view {
  overflow: visible;
}

// Day column in week view
.ncv-day-column {
  overflow: visible;
}

// All-day events styles
.ncv-all-day-events-section {
  margin-bottom: var(--calendar-spacing-xl);
}

.ncv-all-day-header {
  font-weight: var(--calendar-font-weight-medium);
}

.ncv-all-day-events-container {
  min-height: 2rem;
  transition: all var(--calendar-transition-normal);

  &.ncv-drop-zone-active {
    background-color: rgba(59, 130, 246, 0.1);
    border-color: var(--calendar-info);
    box-shadow: var(--calendar-shadow-inset);
  }
}

.ncv-all-day-event-card {
  transition: all var(--calendar-transition-normal) ease-in-out;

  &:hover {
    transform: translateY(-1px);
    box-shadow: var(--calendar-shadow-lg);
  }
}

.ncv-all-day-row {
  min-height: 2rem;
}

.ncv-all-day-events-day {
  min-height: 2rem;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  transition: all var(--calendar-transition-normal);

  &.ncv-drop-zone-active {
    background-color: rgba(59, 130, 246, 0.1);
    border-color: var(--calendar-info);
    box-shadow: var(--calendar-shadow-inset);
  }

  .ncv-all-day-event-card {
    margin-bottom: var(--calendar-spacing-sm);
    flex-shrink: 0; // Prevent shrinking

    &:last-child {
      margin-bottom: 0;
    }
  }

  // Empty state styling
  > div:not(.ncv-all-day-event-card) {
    display: flex;
    align-items: center;
    min-height: 1.5rem;
  }
}

// Month day styles for event display
.ncv-month-day {
  min-height: 6rem;
  transition: all var(--calendar-transition-normal);

  &.ncv-drop-zone-active {
    background-color: rgba(59, 130, 246, 0.1);
    border-color: var(--calendar-info);
    box-shadow: var(--calendar-shadow-inset);
  }

  .ncv-event-card {
    margin-bottom: var(--calendar-spacing-xs); // space-y-0.5 equivalent
    position: relative; // Override absolute positioning for month view
    display: block;
    width: 100%;

    &:last-child {
      margin-bottom: 0;
    }
  }
}

// Event popover styles
.ncv-event-popover {
  animation: fadeIn var(--calendar-transition-normal) ease-in-out;
  box-shadow: var(--calendar-shadow-2xl);

  // Arrow pointing to the event
  &::before {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 8px solid transparent;
    border-top-color: white;
  }

  &::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 9px solid transparent;
    border-top-color: var(--calendar-gray-200);
    margin-top: -1px;
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

// Drag preview styles
.ncv-drag-preview {
  transform: translate(-50%, -50%);
  opacity: var(--calendar-opacity-hover);
  transition: none; // Disable transitions for smooth following

  .ncv-event-card {
    min-width: 200px;
    max-width: 300px;
    transform: rotate(2deg); // Slight rotation for visual effect
    box-shadow: var(--calendar-shadow-2xl);
    border: var(--calendar-border-width-thick) solid rgba(255, 255, 255, 0.8);
  }
}

// Mobile event overlay styles
.ncv-mobile-event-overlay {
  animation: fadeInOverlay var(--calendar-transition-slow) ease-out;
  backdrop-filter: blur(2px);

  .ncv-mobile-event-details {
    animation: slideInUp var(--calendar-transition-slow) ease-out;
    max-height: 90vh;
    overflow-y: auto;

    // Ensure proper touch targets for mobile
    button {
      min-height: 44px; // iOS recommended touch target size
      touch-action: manipulation; // Prevent double-tap zoom
    }

    // Improve readability on mobile
    h3 {
      line-height: var(--calendar-line-height-normal);
    }

    p {
      line-height: var(--calendar-line-height-relaxed);
    }
  }
}

@keyframes fadeInOverlay {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(20px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

// Ensure mobile overlay appears above everything
.ncv-mobile-event-overlay {
  z-index: var(--calendar-z-popover) !important;
}

// Mobile header responsive adjustments
@media (max-width: 768px) {
  .ncv-calendar-header-mobile {
    // Ensure proper touch targets for mobile
    button {
      min-height: 44px; // iOS recommended touch target size
      min-width: 44px;
      touch-action: manipulation; // Prevent double-tap zoom
    }

    // Adjust spacing for mobile
    .ncv-flex.ncv-items-center.ncv-space-x-2 {
      gap: var(--calendar-spacing-md); // Reduce spacing on mobile
    }

    // Make view type selector more compact on mobile
    .ncv-view-type-selector {
      gap: var(--calendar-spacing-xs); // Reduce gap between view type buttons

      .ncv-view-type-button {
        padding: var(--calendar-spacing-sm) var(--calendar-spacing-md); // Smaller padding for mobile
        font-size: var(--calendar-font-size-sm); // Smaller font size
      }
    }

    // Adjust title text size for mobile (now in top row)
    h2 {
      font-size: var(--calendar-font-size-lg); // Slightly smaller title on mobile
      line-height: var(--calendar-line-height-tight);
      margin-bottom: 0; // Remove default margin since we have mb-3 on container
    }

    // Ensure Today button is touch-friendly
    .ncv-today-button {
      padding: var(--calendar-spacing-md) var(--calendar-spacing-lg); // Adequate touch target
      font-size: var(--calendar-font-size-base);
    }

    // Adjust spacing between rows
    .ncv-text-center.ncv-mb-3 {
      margin-bottom: var(--calendar-spacing-lg); // Consistent spacing between date and controls
    }

    // Ensure proper alignment for the two-row layout
    .ncv-flex.ncv-items-center.ncv-justify-between {
      align-items: center;
      min-height: 44px; // Ensure minimum height for touch targets
    }
  }

  // Mobile overlay adjustments
  .ncv-mobile-event-overlay {
    padding: var(--calendar-spacing-xl);

    .ncv-mobile-event-details {
      margin: 0;
      max-width: none;
      width: 100%;
    }
  }
}

// Extra small screens (phones in portrait)
@media (max-width: 480px) {
  .ncv-calendar-header-mobile {
    padding: var(--calendar-spacing-lg); // Reduce padding on very small screens

    // Make navigation buttons smaller but still touchable
    .ncv-flex.ncv-items-center.ncv-space-x-2 {
      gap: var(--calendar-spacing-sm);

      button {
        padding: var(--calendar-spacing-md); // Smaller padding
        min-width: 40px; // Slightly smaller but still touchable
        min-height: 40px;
      }
    }

    // Make title even smaller on very small screens
    h2 {
      font-size: var(--calendar-font-size-base);
    }

    // Make view type selector even more compact
    .ncv-view-type-selector {
      .ncv-view-type-button {
        padding: var(--calendar-spacing-sm) var(--calendar-spacing-sm);
        font-size: var(--calendar-font-size-xs); // 11px
      }
    }

    // Adjust Today button for small screens
    .ncv-today-button {
      padding: var(--calendar-spacing-sm) var(--calendar-spacing-md);
      font-size: var(--calendar-font-size-sm);
    }

    // Reduce spacing between rows on very small screens
    .ncv-text-center.ncv-mb-3 {
      margin-bottom: var(--calendar-spacing-md);
    }
  }
}
